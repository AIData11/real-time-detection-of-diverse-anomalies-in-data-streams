\documentclass[11pt,a4paper]{article}
\usepackage[margin=1in]{geometry}
\usepackage{amsmath}
\usepackage{array}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{caption}

% Allow algorithms to break across pages
\makeatletter
\newenvironment{breakablealgorithm}
  {% \begin{breakablealgorithm}
   \begin{center}
     \refstepcounter{algorithm}% New algorithm
     \hrule height.8pt depth0pt \kern2pt% \@fs@pre for \@fs@ruled
     \renewcommand{\caption}[2][\relax]{% Make a new \caption
       {\raggedright\textbf{Algorithm \thealgorithm} ##2\par}%
       \ifx\relax##1\relax % #1 is \relax
         \addcontentsline{loa}{algorithm}{\protect\numberline{\thealgorithm}##2}%
       \else % #1 is not \relax
         \addcontentsline{loa}{algorithm}{\protect\numberline{\thealgorithm}##1}%
       \fi
       \kern2pt\hrule\kern2pt
     }
  }{% \end{breakablealgorithm}
     \kern2pt\hrule\relax% \@fs@post for \@fs@ruled
   \end{center}
  }
\makeatother

% Set algorithm counter to 13 so next will be 14
\setcounter{algorithm}{13}

\begin{document}

\section*{Algorithm 14: Anomaly Classification}

\begin{breakablealgorithm}
\small
\caption{Anomaly Classification}
\begin{flushleft}
\textbf{Input:} stream\_data\_anomaly \\
\textbf{Output:} stream\_data\_anomaly with anomaly classification attribute \\

\vspace{0.2cm}
\textbf{1:} \textbf{for} new\_data in stream\_data\_anomaly \textbf{do} \\
\textbf{2:} \quad anomaly\_type\_dict $\gets$ new\_data.get('anomaly\_type', \{\}) \\
\textbf{3:} \quad anomaly\_classification $\gets$ \{\} \\
\textbf{4:} \quad sensor\_id $\gets$ new\_data.get('sensor\_id') \\
\textbf{5:} \quad timestamp $\gets$ pd.to\_datetime(new\_data.get('created\_at')) \\
\textbf{6:} \quad \textbf{for} sens\_id in list(self.history.keys()) \textbf{do} \\
\textbf{7:} \quad\quad self.history[sens\_id] $\gets$ [i for i in self.history[sens\_id] if \\
\quad\quad\quad\quad\quad\quad (timestamp - pd.to\_datetime(i['created\_at'])) $\leq$ timedelta(minutes=2)] \\
\textbf{8:} \quad \textbf{end for} \\
\textbf{9:} \quad self.history[sensor\_id].append(new\_data) \\
\textbf{10:} \quad \textbf{for} field, anomaly\_type in anomaly\_type\_dict.items() \textbf{do} \\
\textbf{11:} \quad\quad excluded\_fields $\gets$ ['sensor\_id', 'created\_at', 'enter\_id', 'entry\_id', \\
\quad\quad\quad\quad 'model\_anomaly', 'is\_anomaly', '\_\_field\_mapping\_\_', 'type of anomaly', \\
\quad\quad\quad\quad 'type classification', 'type\_of\_anomaly', 'type\_classification', \\
\quad\quad\quad\quad 'anomaly\_type', 'anomaly\_classification'] \\
\textbf{12:} \quad\quad \textbf{if} field $\in$ excluded\_fields \textbf{then} \\
\textbf{13:} \quad\quad\quad \textbf{continue} \\
\textbf{14:} \quad\quad \textbf{end if} \\
\textbf{15:} \quad\quad original\_field $\gets$ new\_data.get('\_\_field\_mapping\_\_', \{\}).get(field, field) \\
\textbf{16:} \quad\quad \textbf{if} anomaly\_type = 'Duplicated' \textbf{then} \\
\textbf{17:} \quad\quad\quad anomaly\_classification['classification'] $\gets$ 'Error' \\
\textbf{18:} \quad\quad \textbf{else if} anomaly\_type = 'Missing' \textbf{then} \\
\textbf{19:} \quad\quad\quad check\_other\_sensors $\gets$ any(pd.isna(record.get(field)) for sens\_id, \\
\quad\quad\quad\quad\quad records in self.history.items() if sens\_id $\neq$ sensor\_id \\
\quad\quad\quad\quad\quad for record in records if field $\in$ record) \\
\textbf{20:} \quad\quad\quad anomaly\_classification[field] $\gets$ "Uncertain" if check\_other\_sensors \\
\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad else "Error" \\
\textbf{21:} \quad\quad \textbf{else if} anomaly\_type = 'Granularity' \textbf{then} \\
\textbf{22:} \quad\quad\quad anomaly\_classification['classification'] $\gets$ 'Error' \\
\textbf{23:} \quad\quad \textbf{else if} anomaly\_type = 'Stuck' \textbf{then} \\
\textbf{24:} \quad\quad\quad anomaly\_classification[field] $\gets$ "Error" \\
\textbf{25:} \quad\quad \textbf{else if} anomaly\_type = 'Non-numeric' \textbf{then} \\
\textbf{26:} \quad\quad\quad anomaly\_classification[field] $\gets$ "Error" \\
\textbf{27:} \quad\quad \textbf{else if} 'Extreme' $\in$ anomaly\_type \textbf{then} \\
\textbf{28:} \quad\quad\quad confirmed\_by\_nearby\_sensor $\gets$ false \\
\textbf{29:} \quad\quad\quad \textbf{try} \\
\textbf{30:} \quad\quad\quad\quad current\_field\_value $\gets$ float(new\_data.get(field, 0)) \\
\textbf{31:} \quad\quad\quad \textbf{except} (TypeError, ValueError) \\
\textbf{32:} \quad\quad\quad\quad current\_field\_value $\gets$ null \\
\textbf{33:} \quad\quad\quad \textbf{end try} \\
\textbf{34:} \quad\quad\quad \textbf{if} current\_field\_value $\neq$ null \textbf{then} \\
\textbf{35:} \quad\quad\quad\quad \textbf{for} sens\_id, records in self.history.items() \textbf{do} \\
\textbf{36:} \quad\quad\quad\quad\quad \textbf{if} sens\_id = sensor\_id \textbf{then} \\
\textbf{37:} \quad\quad\quad\quad\quad\quad \textbf{continue} \\
\textbf{38:} \quad\quad\quad\quad\quad \textbf{end if} \\
\textbf{39:} \quad\quad\quad\quad\quad values\_list $\gets$ [ ] \\
\textbf{40:} \quad\quad\quad\quad\quad \textbf{for} record in records \textbf{do} \\
\textbf{41:} \quad\quad\quad\quad\quad\quad \textbf{if} field $\in$ record and record.get(field) $\neq$ null \textbf{then} \\
\textbf{42:} \quad\quad\quad\quad\quad\quad\quad \textbf{try} \\
\textbf{43:} \quad\quad\quad\quad\quad\quad\quad\quad value $\gets$ float(record[field]) \\
\textbf{44:} \quad\quad\quad\quad\quad\quad\quad\quad \textbf{if} $\lnot$ pd.isna(value) \textbf{then} \\
\textbf{45:} \quad\quad\quad\quad\quad\quad\quad\quad\quad values\_list.append(value) \\
\textbf{46:} \quad\quad\quad\quad\quad\quad\quad\quad \textbf{end if} \\
\textbf{47:} \quad\quad\quad\quad\quad\quad\quad \textbf{except} (TypeError, ValueError) \\
\textbf{48:} \quad\quad\quad\quad\quad\quad\quad\quad \textbf{continue} \\
\textbf{49:} \quad\quad\quad\quad\quad\quad\quad \textbf{end try} \\
\textbf{50:} \quad\quad\quad\quad\quad\quad \textbf{end if} \\
\textbf{51:} \quad\quad\quad\quad\quad \textbf{end for} \\
\textbf{52:} \quad\quad\quad\quad\quad \textbf{if} $|$values\_list$|$ $\geq$ 5 \textbf{then} \\
\textbf{53:} \quad\quad\quad\quad\quad\quad \textbf{if} $|$values\_list$|$ > 1 \textbf{then} \\
\textbf{54:} \quad\quad\quad\quad\quad\quad\quad historical\_values $\gets$ values\_list[:-1] \\
\textbf{55:} \quad\quad\quad\quad\quad\quad\quad recent\_value $\gets$ values\_list[-1] \\
\textbf{56:} \quad\quad\quad\quad\quad\quad\quad \textbf{if} self.\_check\_extreme\_for\_classification(historical\_values, \\
\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad recent\_value) \textbf{then} \\
\textbf{57:} \quad\quad\quad\quad\quad\quad\quad\quad confirmed\_by\_nearby\_sensor $\gets$ true \\
\textbf{58:} \quad\quad\quad\quad\quad\quad\quad\quad \textbf{break} \\
\textbf{59:} \quad\quad\quad\quad\quad\quad\quad \textbf{end if} \\
\textbf{60:} \quad\quad\quad\quad\quad\quad \textbf{end if} \\
\textbf{61:} \quad\quad\quad\quad\quad \textbf{end if} \\
\textbf{62:} \quad\quad\quad\quad \textbf{end for} \\
\textbf{63:} \quad\quad\quad \textbf{end if} \\
\textbf{64:} \quad\quad\quad \textbf{if} 'Drift' $\in$ anomaly\_type and 'Deviation' $\in$ anomaly\_type \textbf{then} \\
\textbf{65:} \quad\quad\quad\quad anomaly\_classification[field] $\gets$ "Uncertain" \\
\textbf{66:} \quad\quad\quad \textbf{else if} 'Drift' $\in$ anomaly\_type \textbf{then} \\
\textbf{67:} \quad\quad\quad\quad anomaly\_classification[field] $\gets$ "Error" \\
\textbf{68:} \quad\quad\quad \textbf{else if} 'Deviation' $\in$ anomaly\_type \textbf{then} \\
\textbf{69:} \quad\quad\quad\quad anomaly\_classification[field] $\gets$ "Event" \\
\textbf{70:} \quad\quad\quad \textbf{else if} confirmed\_by\_nearby\_sensor \textbf{then} \\
\textbf{71:} \quad\quad\quad\quad anomaly\_classification[field] $\gets$ "Event" \\
\textbf{72:} \quad\quad\quad \textbf{else} \\
\textbf{73:} \quad\quad\quad\quad anomaly\_classification[field] $\gets$ "Error" \\
\textbf{74:} \quad\quad\quad \textbf{end if} \\
\textbf{75:} \quad\quad \textbf{else if} anomaly\_type = 'Drift' \textbf{then} \\
\textbf{76:} \quad\quad\quad anomaly\_classification[field] $\gets$ "Uncertain" \\
\textbf{77:} \quad\quad \textbf{else if} anomaly\_type = 'Deviation' \textbf{then} \\
\textbf{78:} \quad\quad\quad anomaly\_classification[field] $\gets$ "Uncertain" \\
\textbf{79:} \quad\quad \textbf{else if} anomaly\_type = 'Drift, Deviation' \textbf{then} \\
\textbf{80:} \quad\quad\quad anomaly\_classification[field] $\gets$ "Event" \\
\textbf{81:} \quad\quad \textbf{else if} anomaly\_type = 'Undefined anomaly' \textbf{then} \\
\textbf{82:} \quad\quad\quad anomaly\_classification[field] $\gets$ "Uncertain" \\
\textbf{83:} \quad\quad \textbf{else} \\
\textbf{84:} \quad\quad\quad anomaly\_classification[field] $\gets$ "Uncertain" \\
\textbf{85:} \quad\quad \textbf{end if} \\
\textbf{86:} \quad \textbf{end for} \\
\textbf{87:} \quad new\_data['anomaly\_classification'] $\gets$ anomaly\_classification \\
\textbf{88:} \textbf{end for} \\
\textbf{89:} \textbf{return} stream\_data\_anomaly
\end{flushleft}
\end{breakablealgorithm}

\end{document}